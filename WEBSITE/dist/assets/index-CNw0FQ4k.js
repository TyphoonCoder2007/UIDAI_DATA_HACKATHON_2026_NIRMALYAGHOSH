(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const w={saturation:{critical:40,warning:60},volatility:{high:150}},q=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"],U=["Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"],T=[...q,...U],B={"Uttar Pradesh":240,Maharashtra:130,Bihar:128,"West Bengal":100,"Madhya Pradesh":87,"Tamil Nadu":80,Rajasthan:82,Karnataka:70,Gujarat:72,"Andhra Pradesh":53,Odisha:47,Telangana:40,Kerala:36,Jharkhand:40,Assam:36,Punjab:31,Chhattisgarh:30,Haryana:30,Delhi:21,"Jammu and Kashmir":14,Uttarakhand:12,"Himachal Pradesh":8,Tripura:4.5,Meghalaya:4,Manipur:3.5,Nagaland:2.5,Goa:1.6,"Arunachal Pradesh":1.7,Puducherry:1.7,Mizoram:1.3,Chandigarh:1.2,Sikkim:.7,"Andaman and Nicobar Islands":.4,"Dadra and Nagar Haveli and Daman and Diu":.6,Ladakh:.3,Lakshadweep:.07},D={"andhra pradesh":"Andhra Pradesh","arunachal pradesh":"Arunachal Pradesh",assam:"Assam",bihar:"Bihar",chhattisgarh:"Chhattisgarh",goa:"Goa",gujarat:"Gujarat",haryana:"Haryana","himachal pradesh":"Himachal Pradesh",jharkhand:"Jharkhand",karnataka:"Karnataka",kerala:"Kerala","madhya pradesh":"Madhya Pradesh",maharashtra:"Maharashtra",manipur:"Manipur",meghalaya:"Meghalaya",mizoram:"Mizoram",nagaland:"Nagaland",odisha:"Odisha",orissa:"Odisha",punjab:"Punjab",rajasthan:"Rajasthan",sikkim:"Sikkim","tamil nadu":"Tamil Nadu",tamilnadu:"Tamil Nadu",telangana:"Telangana",tripura:"Tripura","uttar pradesh":"Uttar Pradesh",uttarpradesh:"Uttar Pradesh",uttarakhand:"Uttarakhand",uttaranchal:"Uttarakhand","west bengal":"West Bengal",westbengal:"West Bengal",delhi:"Delhi","nct of delhi":"Delhi","new delhi":"Delhi",chandigarh:"Chandigarh",puducherry:"Puducherry",pondicherry:"Puducherry","jammu and kashmir":"Jammu and Kashmir","jammu & kashmir":"Jammu and Kashmir","j&k":"Jammu and Kashmir","j & k":"Jammu and Kashmir",ladakh:"Ladakh",lakshadweep:"Lakshadweep","andaman and nicobar islands":"Andaman and Nicobar Islands","andaman & nicobar islands":"Andaman and Nicobar Islands","andaman and nicobar":"Andaman and Nicobar Islands","a&n islands":"Andaman and Nicobar Islands","dadra and nagar haveli and daman and diu":"Dadra and Nagar Haveli and Daman and Diu","dadra and nagar haveli":"Dadra and Nagar Haveli and Daman and Diu","daman and diu":"Dadra and Nagar Haveli and Daman and Diu","d&n haveli":"Dadra and Nagar Haveli and Daman and Diu","dadra & nagar haveli":"Dadra and Nagar Haveli and Daman and Diu"},K=new Set(T.map(e=>e.toLowerCase())),A=e=>{if(!e||typeof e!="string")return null;const t=e.trim().toLowerCase();return/^\d+$/.test(t)||t.length<3?null:D[t]?D[t]:K.has(t)?T.find(n=>n.toLowerCase()===t):null},G={enrollment:["/data/enrollment/api_data_aadhar_enrolment_0_500000.csv","/data/enrollment/api_data_aadhar_enrolment_500000_1000000.csv","/data/enrollment/api_data_aadhar_enrolment_1000000_1006029.csv"],demographic:["/data/demographic/api_data_aadhar_demographic_0_500000.csv","/data/demographic/api_data_aadhar_demographic_500000_1000000.csv","/data/demographic/api_data_aadhar_demographic_1000000_1500000.csv","/data/demographic/api_data_aadhar_demographic_1500000_2000000.csv","/data/demographic/api_data_aadhar_demographic_2000000_2071700.csv"],biometric:["/data/biometric/api_data_aadhar_biometric_0_500000.csv","/data/biometric/api_data_aadhar_biometric_500000_1000000.csv","/data/biometric/api_data_aadhar_biometric_1000000_1500000.csv","/data/biometric/api_data_aadhar_biometric_1500000_1861108.csv"]},z=e=>{const t=e.trim().split(`
`);if(t.length<2)return[];const n=t[0].split(",").map(i=>i.trim().toLowerCase().replace(/\s+/g,"_")),a=[];for(let i=1;i<t.length;i++){const o=t[i].split(",").map(s=>s.trim());if(o.length>=n.length){const s={};n.forEach((r,c)=>{s[r]=o[c]}),a.push(s)}}return a},J=async e=>{try{const t=await fetch(e);if(!t.ok)return console.warn(`Failed to fetch ${e}: ${t.status}`),[];const n=await t.text();return z(n)}catch(t){return console.warn(`Error fetching ${e}:`,t.message),[]}},I=async(e,t=null)=>{const n=G[e]||[];let a=[];for(let i=0;i<n.length;i++){const o=await J(n[i]);a=a.concat(o),t&&t(i+1,n.length,n[i])}return console.log(`Loaded ${a.length} ${e} records from ${n.length} files`),a},W=e=>{const t={};return e.forEach(n=>{const a=A(n.state);if(!a)return;t[a]||(t[a]={state:a,total_enrollments:0,age_0_5:0,age_5_17:0,age_18_plus:0,districts:new Set,dates:new Set,dailyEnrollments:{}});const i=parseInt(n.age_0_5||n["0-5_years"]||n["0_5"]||0)||0,o=parseInt(n.age_5_17||n["5-17_years"]||n["5_17"]||0)||0,s=parseInt(n.age_18_greater||n["18+_years"]||n.age_18_plus||n["18_greater"]||0)||0,r=i+o+s;t[a].age_0_5+=i,t[a].age_5_17+=o,t[a].age_18_plus+=s,t[a].total_enrollments+=r,n.district&&t[a].districts.add(n.district),n.date&&(t[a].dates.add(n.date),t[a].dailyEnrollments[n.date]=(t[a].dailyEnrollments[n.date]||0)+r)}),Object.values(t).forEach(n=>{n.district_count=n.districts.size,n.date_count=n.dates.size,delete n.districts,delete n.dates}),t},Q=e=>{const t={};return e.forEach(n=>{const a=A(n.state);if(!a)return;t[a]||(t[a]={state:a,total_demographic_updates:0,demo_5_17:0,demo_17_plus:0,dailyUpdates:{}});const i=parseInt(n.demo_age_5_17||n["5-17_years"]||0)||0,o=parseInt(n.demo_age_17_||n["17+_years"]||n.demo_age_17_plus||0)||0,s=i+o;t[a].demo_5_17+=i,t[a].demo_17_plus+=o,t[a].total_demographic_updates+=s,n.date&&(t[a].dailyUpdates[n.date]=(t[a].dailyUpdates[n.date]||0)+s)}),t},Z=e=>{const t={};return e.forEach(n=>{const a=A(n.state);if(!a)return;t[a]||(t[a]={state:a,total_biometric_updates:0,bio_5_17:0,bio_17_plus:0});const i=parseInt(n.bio_age_5_17||n["5-17_years"]||0)||0,o=parseInt(n.bio_age_17_||n["17+_years"]||n.bio_age_17_plus||0)||0;t[a].bio_5_17+=i,t[a].bio_17_plus+=o,t[a].total_biometric_updates+=i+o}),t},X=(e,t,n)=>{const a={};return new Set([...Object.keys(e),...Object.keys(t),...Object.keys(n)]).forEach(o=>{const s=e[o]||{total_enrollments:0,dailyEnrollments:{}},r=t[o]||{total_demographic_updates:0},c=n[o]||{total_biometric_updates:0},l=B[o]||50,m=l*1e6,f=Math.min(s.total_enrollments/m*100,120),u=Object.values(s.dailyEnrollments||{}),p=u.length>0?u.slice(-7).reduce((h,_)=>h+_,0)/Math.min(7,u.length):0,g=u.length>0?u.slice(-30).reduce((h,_)=>h+_,0)/Math.min(30,u.length):p;let M=0;if(u.length>=2){const h=u.reduce((_,L)=>_+L,0)/u.length;if(h>0){const _=u.reduce((L,F)=>L+Math.pow(F-h,2),0)/u.length;M=Math.sqrt(_)/h*100}}let S=100;if(s.total_enrollments>0){const h=c.total_biometric_updates/s.total_enrollments*100;S=Math.max(0,100-h)}const V=f*.3+Math.min(100,p/Math.max(g,1)*50)*.25+70*.2+S*.15+65*.1;let x="stable";if(g>0){const h=(p-g)/g*100;h>10?x="up":h<-10&&(x="down")}a[o]={state:o,total_enrollments:s.total_enrollments,total_demographic_updates:r.total_demographic_updates,total_biometric_updates:c.total_biometric_updates,population_millions:l,saturation_index:Math.round(f*10)/10,enrollment_velocity_7d:Math.round(p),enrollment_velocity_30d:Math.round(g),volatility_index:Math.round(M*10)/10,stability_score:Math.round(S),health_score:Math.round(V),trend:x,district_count:s.district_count||0,date_count:s.date_count||0,last_updated:new Date().toISOString()}}),a},Y=e=>{const t=[];Object.values(e).forEach(a=>{if(a.saturation_index<w.saturation.critical?t.push({id:`sat_${a.state}`,type:"saturation_risk",severity:"critical",state:a.state,indicator:"Saturation Index",currentValue:a.saturation_index,baselineValue:80,deviationPct:(a.saturation_index-80)/80*100,explanation:`Critically low Aadhaar coverage in ${a.state} (${a.saturation_index.toFixed(1)}%). Population: ${a.population_millions}M, Enrollments: ${a.total_enrollments.toLocaleString()}`,suggestedAction:"Deploy mobile enrollment camps. Partner with ASHA workers for door-to-door enrollment drives.",confidence:.95,timestamp:new Date}):a.saturation_index<w.saturation.warning&&t.push({id:`sat_${a.state}`,type:"saturation_risk",severity:"warning",state:a.state,indicator:"Saturation Index",currentValue:a.saturation_index,baselineValue:80,deviationPct:(a.saturation_index-80)/80*100,explanation:`Below-target Aadhaar coverage in ${a.state} (${a.saturation_index.toFixed(1)}%). Gaps exist in reaching target population.`,suggestedAction:"Increase enrollment center hours. Target awareness campaigns to underserved communities.",confidence:.85,timestamp:new Date}),a.enrollment_velocity_30d>0){const i=(a.enrollment_velocity_30d-a.enrollment_velocity_7d)/a.enrollment_velocity_30d*100;i>=50?t.push({id:`vel_${a.state}`,type:"enrollment_drop",severity:"critical",state:a.state,indicator:"Enrollment Velocity",currentValue:a.enrollment_velocity_7d,baselineValue:a.enrollment_velocity_30d,deviationPct:-i,explanation:`Enrollment velocity in ${a.state} dropped ${i.toFixed(0)}%. Current: ${a.enrollment_velocity_7d.toLocaleString()}/day vs 30-day avg: ${a.enrollment_velocity_30d.toLocaleString()}/day`,suggestedAction:"Investigate infrastructure outages or resource allocation gaps. Coordinate with regional enrollment centers.",confidence:.9,timestamp:new Date}):i>=30&&t.push({id:`vel_${a.state}`,type:"enrollment_drop",severity:"warning",state:a.state,indicator:"Enrollment Velocity",currentValue:a.enrollment_velocity_7d,baselineValue:a.enrollment_velocity_30d,deviationPct:-i,explanation:`Enrollment velocity in ${a.state} declined ${i.toFixed(0)}% from baseline.`,suggestedAction:"Monitor for continued decline. Review enrollment center capacity.",confidence:.85,timestamp:new Date})}a.volatility_index>w.volatility.high&&t.push({id:`vol_${a.state}`,type:"volatility_spike",severity:"warning",state:a.state,indicator:"Volatility Index",currentValue:a.volatility_index,baselineValue:50,deviationPct:(a.volatility_index-50)/50*100,explanation:`High operational volatility in ${a.state} (CV: ${a.volatility_index.toFixed(0)}%). Daily patterns are highly irregular.`,suggestedAction:"Review enrollment center operating hours and staffing consistency.",confidence:.7,timestamp:new Date}),a.stability_score<40&&t.push({id:`bio_${a.state}`,type:"biometric_pressure",severity:"warning",state:a.state,indicator:"Biometric Stability",currentValue:a.stability_score,baselineValue:80,deviationPct:(a.stability_score-80)/80*100,explanation:`High biometric update pressure in ${a.state} (Stability: ${a.stability_score}). May indicate aging population or quality issues.`,suggestedAction:"Audit biometric capture quality. Consider targeted infrastructure upgrades.",confidence:.8,timestamp:new Date})});const n={critical:0,warning:1,info:2};return t.sort((a,i)=>n[a.severity]-n[i.severity]),t},tt=e=>{const t=[],n=Object.values(e);if(n.length===0)return t;const a=n.filter(s=>s.saturation_index>0).sort((s,r)=>s.saturation_index-r.saturation_index);if(a.length>=3){const s=a.slice(0,3);t.push({id:"insight_saturation",category:"policy",title:"Enrollment Coverage Gap Identified",description:`Three states show significantly lower Aadhaar saturation: ${s.map(r=>`${r.state} (${r.saturation_index.toFixed(1)}%)`).join(", ")}. Combined population: ${s.reduce((r,c)=>r+c.population_millions,0).toFixed(0)}M people in underserved regions.`,affectedRegions:s.map(r=>r.state),recommendation:"Prioritize mobile enrollment camps and ASHA worker integration in these states. Consider extended hours and weekend operations.",priority:"high",dataPoints:Object.fromEntries(s.map(r=>[r.state,r.saturation_index])),timestamp:new Date})}const i=n.filter(s=>s.total_enrollments>0).sort((s,r)=>r.total_enrollments-s.total_enrollments);if(i.length>=3){const s=i.slice(0,3),r=n.reduce((l,m)=>l+m.total_enrollments,0),c=(s.reduce((l,m)=>l+m.total_enrollments,0)/r*100).toFixed(0);t.push({id:"insight_concentration",category:"operational",title:"Enrollment Concentration Analysis",description:`Top 3 states (${s.map(l=>l.state).join(", ")}) account for ${c}% of all enrollments. Total: ${r.toLocaleString()} enrollments across ${n.length} states.`,affectedRegions:s.map(l=>l.state),recommendation:"Ensure infrastructure capacity matches demand in high-volume states. Consider load balancing strategies.",priority:"medium",dataPoints:Object.fromEntries(s.map(l=>[l.state,l.total_enrollments])),timestamp:new Date})}const o=n.filter(s=>s.trend==="down"&&s.enrollment_velocity_7d>0);return o.length>=2&&t.push({id:"insight_velocity",category:"operational",title:"Multiple States Showing Declining Velocity",description:`${o.length} states show declining enrollment velocity: ${o.slice(0,5).map(s=>s.state).join(", ")}. This may indicate seasonal patterns or operational challenges.`,affectedRegions:o.map(s=>s.state),recommendation:"Cross-reference with festival calendars and operational schedules. Consider targeted campaigns.",priority:"medium",timestamp:new Date}),t},k=async(e=null)=>{console.log("üìä Loading REAL data from CSV files..."),e&&e("enrollment",0,3);const t=await I("enrollment");e&&e("demographic",1,3);const n=await I("demographic");e&&e("biometric",2,3);const a=await I("biometric");console.log("üìà Aggregating data by state...");const i=W(t),o=Q(n),s=Z(a);console.log("üî¢ Calculating real indicators...");const r=X(i,o,s);console.log("‚ö†Ô∏è Generating alerts...");const c=Y(r);console.log("üí° Generating insights...");const l=tt(r),m=Object.values(r).reduce((p,g)=>p+g.total_enrollments,0),f=Object.values(r).reduce((p,g)=>p+g.total_demographic_updates,0),u=Object.values(r).reduce((p,g)=>p+g.total_biometric_updates,0);return console.log(`‚úÖ Loaded REAL data: ${m.toLocaleString()} enrollments, ${f.toLocaleString()} demographic updates, ${u.toLocaleString()} biometric updates across ${Object.keys(r).length} states`),{metrics:r,alerts:c,insights:l,summary:{totalEnrollments:m,totalDemographic:f,totalBiometric:u,stateCount:Object.keys(r).length,alertCount:c.length,insightCount:l.length}}},d={currentPage:"dashboard",selectedState:null,metrics:{},alerts:[],insights:[],isLoading:!0,loadError:null,dataSummary:null},et=async()=>{console.log("üöÄ Initializing Aadhaar Intelligence Platform..."),console.log("üìä MODE: REAL DATA (Loading from CSV files)"),v("Loading Data..."),ot(),at(),ct(),nt();try{const e=await k((t,n,a)=>{v(`Loading ${t}... (${n+1}/${a})`)});d.metrics=e.metrics,d.alerts=e.alerts,d.insights=e.insights,d.dataSummary=e.summary,d.isLoading=!1,v(`Live Data (${e.summary.stateCount} States)`),P(),j(),H(),C(),it(),console.log("‚úÖ Platform initialized with REAL data"),console.log(`   Total Enrollments: ${e.summary.totalEnrollments.toLocaleString()}`),console.log(`   Total Demographic Updates: ${e.summary.totalDemographic.toLocaleString()}`),console.log(`   Total Biometric Updates: ${e.summary.totalBiometric.toLocaleString()}`),console.log(`   States: ${e.summary.stateCount}`),console.log(`   Alerts: ${e.summary.alertCount}`)}catch(e){console.error("‚ùå Failed to load data:",e),d.loadError=e.message,d.isLoading=!1,v("Data Load Error"),st(e.message)}},at=()=>{const e=document.getElementById("live-clock");if(!e)return;const t=()=>{const n=new Date;e.textContent=n.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})};t(),setInterval(t,1e3)};window.refreshData=async()=>{const e=document.getElementById("refresh-btn");if(!(!e||d.isLoading)){e.classList.add("spinning"),e.disabled=!0,v("Refreshing...");try{const t=await k();d.metrics=t.metrics,d.alerts=t.alerts,d.insights=t.insights,d.dataSummary=t.summary,v(`Live Data (${t.summary.stateCount} States)`),P(),j(),H(),C(),console.log("üîÑ Data refreshed successfully")}catch(t){console.error("‚ùå Refresh failed:",t),v("Refresh Error")}finally{e.classList.remove("spinning"),e.disabled=!1}}};const nt=()=>{const e=document.querySelector(".metrics-grid");e&&(e.innerHTML=`
      <div class="loading-state" style="grid-column: 1/-1; text-align: center; padding: 3rem;">
        <div class="loading-spinner"></div>
        <p style="margin-top: 1rem; color: #6c757d;">Loading real data from CSV files...</p>
        <p style="font-size: 0.8rem; color: #adb5bd;">This may take a moment for large datasets</p>
      </div>
    `)},it=()=>{},st=e=>{const t=document.querySelector(".main-content");t&&(t.innerHTML=`
      <div class="error-state" style="text-align: center; padding: 3rem;">
        <div style="font-size: 3rem;">‚ö†Ô∏è</div>
        <h2>Data Loading Error</h2>
        <p>${e}</p>
        <p style="color: #6c757d; margin-top: 1rem;">
          Make sure CSV files exist in the /data folder and try refreshing.
        </p>
      </div>
    `)},ot=()=>{document.querySelectorAll(".nav-link").forEach(n=>{n.addEventListener("click",a=>{a.preventDefault();const i=n.dataset.page;$(i)})}),window.addEventListener("hashchange",()=>{const n=window.location.hash.replace("#","")||"dashboard";$(n,!1)});const t=window.location.hash.replace("#","")||"dashboard";$(t,!1)},$=(e,t=!0)=>{d.currentPage=e,document.querySelectorAll(".nav-link").forEach(n=>{n.classList.toggle("active",n.dataset.page===e)}),document.querySelectorAll(".page").forEach(n=>{n.classList.toggle("active",n.id===`page-${e}`)}),t&&(window.location.hash=e)},v=e=>{const t=document.getElementById("connection-status"),n=document.querySelector(".status-dot");t&&(t.textContent=e),n&&n.classList.toggle("live",e.includes("Live")||e.includes("States"))},P=()=>{const e=Object.values(d.metrics);if(e.length===0)return;const t=document.querySelector(".metrics-grid");t&&t.querySelector(".loading-state")&&(t.innerHTML=`
      <div class="metric-card" data-metric="saturation">
        <div class="metric-header">
          <span class="metric-label">Saturation Index</span>
          <span class="metric-trend" id="saturation-trend">--</span>
        </div>
        <div class="metric-value" id="saturation-value">--</div>
        <div class="metric-subtext" id="saturation-interpretation">Aadhaar coverage as % of population</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" id="saturation-bar" style="width: 0%"></div>
        </div>
      </div>
      <div class="metric-card" data-metric="velocity">
        <div class="metric-header">
          <span class="metric-label">Enrollment Velocity</span>
          <span class="metric-trend" id="velocity-trend">--</span>
        </div>
        <div class="metric-value" id="velocity-value">--</div>
        <div class="metric-subtext" id="velocity-interpretation">Daily enrollments (7-day avg)</div>
      </div>
      <div class="metric-card" data-metric="stability">
        <div class="metric-header">
          <span class="metric-label">Biometric Stability</span>
          <span class="metric-trend" id="stability-trend">--</span>
        </div>
        <div class="metric-value" id="stability-value">--</div>
        <div class="metric-subtext" id="stability-interpretation">Lower scores indicate refresh pressure</div>
        <div class="metric-bar">
          <div class="metric-bar-fill" id="stability-bar" style="width: 0%"></div>
        </div>
      </div>
      <div class="metric-card" data-metric="health">
        <div class="metric-header">
          <span class="metric-label">Health Score</span>
          <span class="metric-trend" id="health-trend">--</span>
        </div>
        <div class="metric-value" id="health-value">--</div>
        <div class="metric-subtext" id="health-interpretation">Composite inclusion indicator</div>
        <div class="metric-bar">
          <div class="metric-bar-fill health" id="health-bar" style="width: 0%"></div>
        </div>
      </div>
    `),e.reduce((s,r)=>s+(r.total_enrollments||0),0);const n=e.reduce((s,r)=>s+(r.saturation_index||0),0)/e.length,a=e.reduce((s,r)=>s+(r.enrollment_velocity_7d||0),0),i=e.reduce((s,r)=>s+(r.stability_score||0),0)/e.length,o=e.reduce((s,r)=>s+(r.health_score||0),0)/e.length;b("saturation",n.toFixed(1)+"%","stable",n),b("velocity",y(a)+"/day",ht(a,a*.9)),b("stability",i.toFixed(0),E(i),i),b("health",o.toFixed(0),E(o),o),rt(e),lt(e)},b=(e,t,n,a=null)=>{const i=document.getElementById(`${e}-value`),o=document.getElementById(`${e}-trend`),s=document.getElementById(`${e}-bar`);i&&(i.textContent=t),o&&(o.textContent=O(n),o.className=`metric-trend ${n}`),s&&a!==null&&(s.style.width=`${Math.min(100,a)}%`)},rt=e=>{const t=document.getElementById("states-tbody");if(!t)return;const n=[...e].sort((a,i)=>(i.health_score||0)-(a.health_score||0));t.innerHTML=n.map(a=>`
    <tr data-state="${a.state}">
      <td><strong>${a.state}</strong></td>
      <td>${(a.health_score||0).toFixed(0)}</td>
      <td>${(a.saturation_index||0).toFixed(1)}%</td>
      <td>${y(a.enrollment_velocity_7d||0)}/day</td>
      <td class="trend ${a.trend||"stable"}">${O(a.trend)}</td>
      <td>
        <div class="status-cell">
          <span class="status-indicator ${E(a.health_score)}"></span>
          <span>${R(a.health_score)}</span>
        </div>
      </td>
    </tr>
  `).join(""),t.querySelectorAll("tr").forEach(a=>{a.style.cursor="pointer",a.addEventListener("click",()=>{const i=a.dataset.state;N(i),$("regional")})})},lt=e=>{const t=document.getElementById("changes-list"),n=document.getElementById("changes-count");if(!t)return;const a=e.filter(i=>!i.enrollment_velocity_7d||!i.enrollment_velocity_30d?!1:Math.abs((i.enrollment_velocity_7d-i.enrollment_velocity_30d)/i.enrollment_velocity_30d)>.1).map(i=>{const o=(i.enrollment_velocity_7d-i.enrollment_velocity_30d)/i.enrollment_velocity_30d*100;return{state:i.state,change:o.toFixed(0),direction:o>0?"increased":"decreased",velocity7d:i.enrollment_velocity_7d,velocity30d:i.enrollment_velocity_30d}}).sort((i,o)=>Math.abs(o.change)-Math.abs(i.change)).slice(0,5);if(n&&(n.textContent=a.length),a.length===0){t.innerHTML='<div class="empty-state">No significant velocity changes detected</div>';return}t.innerHTML=a.map(i=>`
    <div class="alert-item ${i.direction==="increased"?"info":"warning"}">
      <div class="alert-content-inner">
        <div class="alert-title">${i.state}</div>
        <div class="alert-description">
          Enrollment velocity ${i.direction} by ${Math.abs(i.change)}% 
          (${y(i.velocity7d)}/day vs ${y(i.velocity30d)}/day baseline)
        </div>
      </div>
    </div>
  `).join("")},j=()=>{const e=document.getElementById("alerts-list"),t=document.getElementById("alerts-count");if(!e)return;const n=d.alerts;if(t){const i=n.filter(o=>o.severity==="critical").length;t.textContent=i||n.length,t.className=`badge ${i>0?"critical":""}`}if(n.length===0){e.innerHTML='<div class="empty-state">No active alerts. All indicators within normal ranges.</div>';return}e.innerHTML=n.slice(0,10).map(i=>`
    <div class="alert-item ${i.severity}">
      <span class="alert-severity ${i.severity}">${i.severity}</span>
      <div class="alert-content-inner">
        <div class="alert-title">${i.state} ‚Äî ${i.indicator}</div>
        <div class="alert-description">${i.explanation}</div>
      </div>
    </div>
  `).join("");const a=n.filter(i=>i.severity==="critical");a.length>0&&dt(`${a.length} critical alert(s) require attention`)},dt=e=>{const t=document.getElementById("alert-banner"),n=t==null?void 0:t.querySelector(".alert-content");t&&n&&(n.textContent=e,t.classList.remove("hidden"))};window.dismissAlertBanner=()=>{const e=document.getElementById("alert-banner");e&&e.classList.add("hidden")};const H=()=>{const e=document.getElementById("insights-container");if(!e)return;const t=d.insights;if(t.length===0){e.innerHTML=`
      <div class="empty-state large">
        <div class="placeholder-icon">üìä</div>
        <p>No policy insights currently active</p>
        <p class="subtext">Insights are generated when significant patterns are detected</p>
      </div>
    `;return}e.innerHTML=t.map(n=>`
    <div class="insight-card" onclick="showInsightDetail('${n.id}')">
      <div class="insight-header">
        <span class="insight-title">${n.title}</span>
        <span class="insight-priority ${n.priority}">${n.priority}</span>
      </div>
      <p class="insight-description">${n.description}</p>
      <div class="insight-regions">
        ${(n.affectedRegions||[]).map(a=>`<span class="insight-region-tag">${a}</span>`).join("")}
      </div>
    </div>
  `).join("")};window.showInsightDetail=e=>{const t=d.insights.find(o=>o.id===e);if(!t)return;const n=document.getElementById("insight-modal"),a=document.getElementById("modal-title"),i=document.getElementById("modal-body");a&&(a.textContent=t.title),i&&(i.innerHTML=`
      <div class="insight-detail">
        <p><strong>Category:</strong> ${t.category}</p>
        <p><strong>Priority:</strong> ${t.priority}</p>
        <h3>Analysis</h3>
        <p>${t.description}</p>
        <h3>Affected Regions</h3>
        <p>${(t.affectedRegions||[]).join(", ")}</p>
        <h3>Recommended Action</h3>
        <p>${t.recommendation}</p>
        ${t.dataPoints?`
          <h3>Data Points</h3>
          <ul>
            ${Object.entries(t.dataPoints).map(([o,s])=>`<li><strong>${o}:</strong> ${typeof s=="number"?s.toLocaleString():s}</li>`).join("")}
          </ul>
        `:""}
      </div>
    `),n&&n.classList.remove("hidden")};window.closeInsightModal=()=>{const e=document.getElementById("insight-modal");e&&e.classList.add("hidden")};const ct=()=>{const e=document.getElementById("state-selector");e&&(e.innerHTML='<option value="">Select State (loading...)...</option>',e.addEventListener("change",t=>{N(t.target.value)}))},C=()=>{const e=document.getElementById("state-selector");if(!e)return;const t=Object.keys(d.metrics).sort();e.innerHTML='<option value="">Select State...</option>'+t.map(n=>`<option value="${n}">${n}</option>`).join("")},N=e=>{d.selectedState=e,Object.keys(d.metrics).length>0&&C();const t=document.getElementById("state-selector");t&&(t.value=e);const n=document.getElementById("regional-content"),a=document.getElementById("regional-placeholder");if(!e){n==null||n.classList.add("hidden"),a==null||a.classList.remove("hidden");return}n==null||n.classList.remove("hidden"),a==null||a.classList.add("hidden"),ut(e)},ut=e=>{const t=d.metrics[e]||{},n=t.population_millions||B[e]||50;document.getElementById("selected-state-name").textContent=e,document.getElementById("state-population").textContent=`${n}M`,document.getElementById("state-enrollments").textContent=y(t.total_enrollments||0),document.getElementById("state-saturation").textContent=(t.saturation_index||0).toFixed(1)+"%";const a=document.getElementById("selected-state-status");if(a){const l=E(t.health_score);a.innerHTML=`
      <span class="status-indicator ${l}"></span>
      <span class="status-text">${R(t.health_score)}</span>
    `}document.getElementById("regional-velocity").textContent=y(t.enrollment_velocity_7d||0)+"/day";const i=t.enrollment_velocity_30d>0?((t.enrollment_velocity_7d/t.enrollment_velocity_30d-1)*100).toFixed(0):0;document.getElementById("regional-velocity-detail").textContent=`${i}% vs 30-day avg`,document.getElementById("regional-volatility").textContent=(t.volatility_index||0).toFixed(0)+"%",document.getElementById("regional-volatility-detail").textContent=gt(t.volatility_index),document.getElementById("regional-stability").textContent=(t.stability_score||0).toFixed(0),document.getElementById("regional-stability-detail").textContent=pt(t.stability_score);const o=t.total_demographic_updates&&t.total_enrollments?Math.floor(t.total_demographic_updates/t.total_enrollments*1e3):0;document.getElementById("regional-stress").textContent=o,document.getElementById("regional-stress-detail").textContent="Updates per 1000 enrollments";const s=d.alerts.filter(l=>l.state===e),r=document.getElementById("regional-anomalies");r&&(s.length===0?r.innerHTML='<div class="empty-state">No anomalies detected in this region</div>':r.innerHTML=s.map(l=>`
        <div class="alert-item ${l.severity}">
          <span class="alert-severity ${l.severity}">${l.severity}</span>
          <div class="alert-content-inner">
            <div class="alert-title">${l.indicator}</div>
            <div class="alert-description">${l.explanation}</div>
          </div>
        </div>
      `).join(""));const c=document.getElementById("regional-actions");if(c){const l=mt(e,t);c.innerHTML=l.map(m=>`
      <div class="action-item">
        <span class="action-icon">${m.icon}</span>
        <div class="action-content">
          <div class="action-title">${m.title}</div>
          <div class="action-description">${m.description}</div>
        </div>
      </div>
    `).join("")}},mt=(e,t)=>{var a,i;const n=[];return(t.saturation_index||0)<70&&n.push({icon:"üìã",title:"Expand Enrollment Coverage",description:`Current saturation is ${(a=t.saturation_index)==null?void 0:a.toFixed(1)}%. Deploy mobile enrollment camps in underserved districts.`}),(t.enrollment_velocity_7d||0)<(t.enrollment_velocity_30d||1)*.7&&n.push({icon:"‚ö°",title:"Investigate Velocity Drop",description:`7-day velocity (${y(t.enrollment_velocity_7d)}) is below 30-day average. Check enrollment center capacity.`}),(t.stability_score||100)<60&&n.push({icon:"üîß",title:"Address Biometric Quality",description:`Stability score is ${t.stability_score}. Audit capture equipment quality and schedule maintenance.`}),(t.volatility_index||0)>100&&n.push({icon:"üìä",title:"Reduce Operational Volatility",description:`High volatility (${(i=t.volatility_index)==null?void 0:i.toFixed(0)}%). Review staffing consistency and operating hours.`}),n.length===0&&n.push({icon:"‚úÖ",title:"Maintain Current Operations",description:`All indicators are within acceptable ranges. Total enrollments: ${y(t.total_enrollments)}.`}),n},y=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toFixed(0),O=e=>{switch(e){case"up":return"‚Üë";case"down":return"‚Üì";default:return"‚Üí"}},ht=(e,t)=>{const n=(e-t)/t;return n>.1?"up":n<-.1?"down":"stable"},E=e=>e>=80?"healthy":e>=60?"stable":e>=40?"warning":"critical",R=e=>e>=80?"Healthy":e>=60?"Moderate":e>=40?"Needs Attention":"Critical",gt=e=>e?e<50?"Stable operations":e<100?"Moderate variation":"High irregularity":"No data",pt=e=>e?e>=80?"Excellent stability":e>=60?"Good stability":e>=40?"Elevated refresh activity":"High biometric pressure":"No data";document.addEventListener("DOMContentLoaded",et);
